<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Explorer</title>
    <link rel="stylesheet" href="static/css/style.css">
</head>

<body>

    <header>
        <h1>üé∂ Music Explorer</h1>
        <p>Discover and play your favorite songs</p>
    </header>

    <main>
        <form action="" method="post" class="search-form">
            <input type="search" name="song-search" id="searchbar" placeholder="Search for a song..." />
            <input type="submit" value="Search" />
        </form>

        <div class="songs-container">
            {% for song in songs %}
            <div class="song-card">

                <div class="image-area">
                    <img class="song-image" src="{{ song['image'][1]['url'] }}" alt="Song Art">
                </div>

                <div class="song-details">
                    <h2>{{ song['name'] }}</h2>
                    <p>by <strong>{{ song['artists']['primary'][0]['name'] }}</strong></p>
                    <p>‚è± {{ (song['duration'] // 60)|int }}:{{ '%02d' % (song['duration'] % 60) }}</p>
                    <audio src="{{ song['downloadUrl'][-1]['url'] }}" controls></audio>
                </div>
            </div>
            {% endfor %}
        </div>
    </main>

    <footer>
        <p>üéß Made with ‚ù§Ô∏è for music lovers</p>
    </footer>

    <!-- üé∂ JavaScript to handle play/pause & single playback -->
    <script>
        const allCards = document.querySelectorAll(".song-card");

        allCards.forEach(card => {
            const audio = card.querySelector("audio");
            const img = card.querySelector(".song-image");

            // When a song starts playing
            audio.addEventListener("play", () => {
                // Pause all other audios
                allCards.forEach(otherCard => {
                    const otherAudio = otherCard.querySelector("audio");
                    const otherImg = otherCard.querySelector(".song-image");
                    if (otherAudio !== audio) {
                        otherAudio.pause();
                        otherImg.classList.remove("playing");
                    }
                });

                // Start animation for this song
                img.classList.add("playing");
            });

            // When paused or ended
            audio.addEventListener("pause", () => img.classList.remove("playing"));
            audio.addEventListener("ended", () => img.classList.remove("playing"));
        });
    </script>

</body>

</html>
